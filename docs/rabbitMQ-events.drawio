<mxfile host="Electron" modified="2023-04-21T07:42:03.162Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.2.1 Chrome/112.0.5615.87 Electron/24.1.2 Safari/537.36" etag="epkyE4EtDh8aEtc6zmeq" version="21.2.1" type="device">
  <diagram name="Page-1" id="hG6ZjCvNAPdhJkc7tSRy">
    <mxGraphModel dx="2794" dy="742" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="sYY-K0hRYDt8o--p5X97-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-1" target="sYY-K0hRYDt8o--p5X97-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-1" value="blocktank.events" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="-1507" y="200" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-2" value="RabbitPublisher" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;width=130;height=30;" vertex="1" parent="1">
          <mxGeometry x="-1577" y="120" width="750" height="230" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-3" value="&lt;h1&gt;Exchange&lt;/h1&gt;&lt;p&gt;Type: Fanout&lt;br&gt;&lt;br&gt;All new events are sent here. Fanout makes sure to send a copy of each event to all queues/exchanges that subscribe to this exchange.&lt;/p&gt;&lt;p&gt;Every event has a routingKey associated. &lt;br&gt;Pattern: `{workerName}.{eventName}`.&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-1237" y="140" width="280" height="190" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-4" target="sYY-K0hRYDt8o--p5X97-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-4" value="blocktank.{workerName}.consumer" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="-1507" y="450" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-5" value="RabbitConsumer" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;width=130;height=30;" vertex="1" parent="1">
          <mxGeometry x="-1577" y="370" width="750" height="570" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-6" value="&lt;h1&gt;Exchange&lt;/h1&gt;&lt;p&gt;Type: Topic /&amp;nbsp;x-delayed-message&lt;/p&gt;&lt;p&gt;Created on (Consumer)Worker startup. Subscribes to the all blocktank events.&lt;br&gt;&lt;br&gt;Topic gives the exchange the ability to only forward events a queue asked for based on the routingKey. In simple terms: Only forwards events that the worker actually subscribed to.&lt;/p&gt;&lt;p&gt;x-delayed-message is a special plugin that allows events to be delayed. This is used for the error backoff.&lt;br&gt;https://github.com/rabbitmq/rabbitmq-delayed-message-exchange&lt;br&gt;&lt;br&gt;This exchange is deleted when there are no queues left that subscribe to it.&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-1237" y="400" width="280" height="310" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-8" target="sYY-K0hRYDt8o--p5X97-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-12" value="OnError:&lt;br&gt;Requeue with a &lt;br&gt;backoff delay." style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="sYY-K0hRYDt8o--p5X97-11">
          <mxGeometry x="0.1029" y="2" relative="1" as="geometry">
            <mxPoint x="2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-8" value="blocktank.&lt;br&gt;{workerName}.{routingKey}" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="-1507" y="760" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-9" value="&lt;h1&gt;Queue&lt;/h1&gt;&lt;p&gt;routingKey: `{workerName}.{eventName}`&lt;/p&gt;&lt;p&gt;A queue subscribes to a specific routingKey and only receives such messages. The routing key is basically the eventName so every event has it&#39;s own queue.&lt;br&gt;&lt;br&gt;This queue is deleted after a defined expiration time (default 1 week) after no worker connected to it.&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-1237" y="720" width="280" height="220" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-18" target="sYY-K0hRYDt8o--p5X97-27">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="25" y="600" />
              <mxPoint x="30" y="600" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-18" value="blocktank.events&lt;br&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;exchange&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="-80" y="480" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-20" target="sYY-K0hRYDt8o--p5X97-18">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-20" value="lightning worker 1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="-335" y="130" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-21" target="sYY-K0hRYDt8o--p5X97-18">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-120" y="340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-21" value="lightning worker 2" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="-80" y="130" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-22" target="sYY-K0hRYDt8o--p5X97-18">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="200" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-22" value="bitcoin worker 1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="185" y="130" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-15" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;lightning&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;invoicePaid&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;attempt&quot;: 0,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;routingKey&quot;: &quot;lightning.invoicePaid&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;white-space: pre; font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#6c8ebf;fillColor=#e0e8f0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="-360" y="310" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-26" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;bitcoin&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;newBlock&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;attempt&quot;: 0,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;routingKey&quot;: &quot;bitcoin.newBlock&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;white-space: pre; font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#6c8ebf;fillColor=#e0e8f0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="330" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-27" target="sYY-K0hRYDt8o--p5X97-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-27" target="sYY-K0hRYDt8o--p5X97-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-27" value="blocktank.instant.consumer&lt;br&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;exchange&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="-80" y="910" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-30" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;lightning&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;invoicePaid&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;attempt&quot;: 0,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt; &quot;routingKey&quot;: &quot;lightning.invoicePaid&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;white-space: pre; font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#6c8ebf;fillColor=#e0e8f0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="-75" y="790" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-31" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;bitcoin&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;newBlock&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;attempt&quot;: 0,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;routingKey&quot;: &quot;bitcoin.newBlock&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;white-space: pre; font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#6c8ebf;fillColor=#e0e8f0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="-75" y="680" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-33" target="sYY-K0hRYDt8o--p5X97-43">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-33" target="sYY-K0hRYDt8o--p5X97-44">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-160" y="1260" />
              <mxPoint x="240" y="1260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-33" value="blocktank.instant.lightning.invoicePaid&lt;br&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;queue, routingKey: lightning.invoicePaid&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="-310" y="1170" width="300" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-34" target="sYY-K0hRYDt8o--p5X97-43">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="240" y="1260" />
              <mxPoint x="-160" y="1260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-34" value="blocktank.instant.bitcoin.newBlock&lt;br&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;queue, routingKey: bitcoin.newBlock&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="90" y="1170" width="300" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-35" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;bitcoin&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;txConfirmed&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;attempt&quot;: 0,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;routingKey&quot;: &quot;bitcoin.txConfirmed&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#6c8ebf;fillColor=#e0e8f0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="240" y="210" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-36" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;bitcoin&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;txConfirmed&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;attempt&quot;: 0,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;routingKey&quot;: &quot;bitcoin.txConfirmed&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#6c8ebf;fillColor=#e0e8f0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="-75" y="570" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-39" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;lightning&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;invoicePaid&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;attempt&quot;: 0,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;routingKey&quot;: &quot;lightning.invoicePaid&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;white-space: pre; font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#6c8ebf;fillColor=#e0e8f0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="-285" y="1030" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-40" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;bitcoin&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;newBlock&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;attempt&quot;: 0,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;routingKey&quot;: &quot;bitcoin.newBlock&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;white-space: pre; font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#6c8ebf;fillColor=#e0e8f0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="130" y="1030" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-41" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;bitcoin&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;txConfirmed&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;attempt&quot;: 0,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;routingKey&quot;: &quot;bitcoin.txConfirmed&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="340" y="920" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-42" value="3.2 bitcoin.txConfirmed gets discarded because no queue subscribes to this routingKey/event." style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="520" y="980" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="sYY-K0hRYDt8o--p5X97-43" target="sYY-K0hRYDt8o--p5X97-27">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-470" y="1435" />
              <mxPoint x="-470" y="945" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-43" value="Blocktank Instant worker 1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="-270" y="1400" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-44" value="Blocktank Instant worker 2" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="130" y="1400" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-50" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;lightning&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;invoicePaid&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;attempt&quot;: 1&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;routingKey&quot;: &quot;lightning.invoicePaid&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;white-space: pre; font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#6c8ebf;fillColor=#e0e8f0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="-600" y="1260" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-51" value="5. On error:&lt;br&gt;Events are&amp;nbsp;requeue with a delay. The event is placed behind all new incoming events to prevent infinite loops.&lt;br&gt;A different worker might pick up the event the next time." style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="-600" y="1120" width="220" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-52" value="1. Workers create events and send them to the main blocktank.events exchange." style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="-640" y="280" width="220" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-53" value="2. blocktank.instant.consumer subscribes to the events and only picks the one it is interested in." style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="-330" y="810" width="220" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-54" value="3.1 Each queue is filled with one event type." style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="450" y="1155" width="140" height="85" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-55" value="&lt;b&gt;Event&lt;/b&gt;&lt;br&gt;{&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;sourceWorker&quot;: &quot;lightning&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;eventName&quot;: &quot;invoicePaid&quot;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;attempt&quot;: 0,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&quot;routingKey&quot;: &quot;lightning.invoicePaid&quot;&lt;/b&gt;,&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &quot;content&quot;: ...&lt;span style=&quot;white-space: pre; font-size: 10px;&quot;&gt;	&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;}" style="text;html=1;strokeColor=#6c8ebf;fillColor=#e0e8f0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="-265" y="1280" width="210" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-56" value="4. A single worker processes the event." style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="-80" y="1450" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-57" value="RabbitMQ object structure" style="text;strokeColor=none;fillColor=none;html=1;fontSize=24;fontStyle=1;verticalAlign=middle;align=center;" vertex="1" parent="1">
          <mxGeometry x="-1480" y="50" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="sYY-K0hRYDt8o--p5X97-59" value="Example" style="text;strokeColor=none;fillColor=none;html=1;fontSize=24;fontStyle=1;verticalAlign=middle;align=center;" vertex="1" parent="1">
          <mxGeometry x="-640" y="50" width="100" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
